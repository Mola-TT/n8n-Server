# default.env - Default environment variables for n8n server setup

# ==============================================================================
# SYSTEM CONFIGURATION
# ==============================================================================
SERVER_TIMEZONE="Asia/Hong_Kong"
SERVER_HOSTNAME="n8n-server"
LOG_LEVEL="INFO"
LOG_FILE="/var/log/server_init.log"
SYSTEM_UPDATE="true"
RUN_TESTS="true"
PRODUCTION="false"
FORCE_ATTENDED_UPGRADE="true"

# ==============================================================================
# SECURITY & FIREWALL
# ==============================================================================
ENABLE_FIREWALL="true"
CONFIGURE_FIREWALL="true"

# ==============================================================================
# NGINX CONFIGURATION (MILESTONE 3)
# ==============================================================================
NGINX_ENABLED="true"
NGINX_HTTP_PORT="80"
NGINX_HTTPS_PORT="443"
NGINX_SERVER_NAME="localhost"
NGINX_SSL_CERT_PATH="/etc/nginx/ssl/certificate.crt"
NGINX_SSL_KEY_PATH="/etc/nginx/ssl/private.key"
NGINX_PROXY_PASS="http://localhost:5678"
NGINX_CLIENT_MAX_BODY_SIZE="100M"
NGINX_PROXY_TIMEOUT="300s"
NGINX_SSL_REDIRECT="true"
NGINX_SECURITY_HEADERS="true"
NGINX_RATE_LIMIT="true"
# Rate limiting configuration (reasonable defaults for n8n)
# n8n loads ~150 assets on page load, so burst must be high enough
NGINX_RATE_LIMIT_GLOBAL="50r/s"
NGINX_RATE_LIMIT_USER="100r/s"
NGINX_RATE_BURST_GLOBAL="200"
NGINX_RATE_BURST_USER="300"
NGINX_RATE_BURST_API="50"
NGINX_ACCESS_LOG="/var/log/nginx/n8n_access.log"
NGINX_ERROR_LOG="/var/log/nginx/n8n_error.log"

# ==============================================================================
# N8N CONFIGURATION
# ==============================================================================
N8N_SERVER_IP="localhost"
N8N_SERVER_DOMAIN="localhost"
N8N_PORT="5678"
N8N_HOST="0.0.0.0"
N8N_PROTOCOL="https"
N8N_TRUST_PROXY="true"
# N8N_WEBHOOK_URL and N8N_EDITOR_BASE_URL are auto-derived from N8N_SERVER_IP

# Web Interface Authentication
N8N_BASIC_AUTH_ACTIVE="true"
N8N_BASIC_AUTH_USER="admin"
N8N_BASIC_AUTH_PASSWORD="strongpassword"

# ==============================================================================
# DOCKER CONFIGURATION (MILESTONE 2)
# ==============================================================================
DOCKER_COMPOSE_FILE="/opt/n8n/docker/docker-compose.yml"
N8N_DATA_DIR="/opt/n8n"

# ==============================================================================
# SSL/TLS CONFIGURATION
# ==============================================================================
N8N_SSL_KEY="/opt/n8n/ssl/private.key"
N8N_SSL_CERT="/opt/n8n/ssl/certificate.crt"
SSL_ENABLED="true"

# ==============================================================================
# DATABASE CONFIGURATION (EXTERNAL POSTGRESQL)
# ==============================================================================
DB_HOST="localhost"
DB_PORT="5432"
DB_NAME="n8n"
DB_USER="n8n_user"
DB_PASSWORD="your_secure_password"
DB_SSL_ENABLED="false"

# ==============================================================================
# REDIS CONFIGURATION
# ==============================================================================
REDIS_DB="0"

# ==============================================================================
# EMAIL CONFIGURATION (GLOBAL)
# ==============================================================================
EMAIL_SENDER="n8n@localhost"
EMAIL_RECIPIENT="admin@example.com"
SMTP_SERVER="localhost"
SMTP_PORT="25"
SMTP_TLS="NO"
SMTP_USERNAME="testuser"
SMTP_PASSWORD="testpass"

# Email Notification Configuration (Milestone 6)
# Configure these settings for hardware change notifications
EMAIL_COOLDOWN_HOURS="24"
EMAIL_SUBJECT_PREFIX="[n8n Server]"
TEST_EMAIL_SUBJECT="n8n Server Test Email"

# ==============================================================================
# NETDATA CONFIGURATION (MILESTONE 4)
# ==============================================================================
NETDATA_ENABLED="true"
NETDATA_PORT="19999"
NETDATA_BIND_IP="127.0.0.1"
NETDATA_WEB_DIR="/usr/share/netdata/web"
NETDATA_CACHE_DIR="/var/cache/netdata"
NETDATA_LIB_DIR="/var/lib/netdata"
NETDATA_LOG_DIR="/var/log/netdata"
NETDATA_RUN_DIR="/var/run/netdata"

# Netdata Nginx Proxy Configuration
NETDATA_NGINX_SUBDOMAIN="monitor"
NETDATA_NGINX_AUTH_USER="netdata"
NETDATA_NGINX_AUTH_PASSWORD="secure_monitoring_password"
NETDATA_NGINX_ACCESS_LOG="/var/log/nginx/netdata_access.log"
NETDATA_NGINX_ERROR_LOG="/var/log/nginx/netdata_error.log"

# Health Monitoring Thresholds
NETDATA_CPU_THRESHOLD="80"
NETDATA_RAM_THRESHOLD="80"
NETDATA_DISK_THRESHOLD="80"
NETDATA_LOAD_THRESHOLD="3.0"

# Netdata Alert Configuration
NETDATA_ALERTS_ENABLED="true"
NETDATA_EMAIL_ALERTS="true"
NETDATA_ALERT_EMAIL_RECIPIENT="${EMAIL_RECIPIENT}"
NETDATA_ALERT_EMAIL_SENDER="${EMAIL_SENDER}"

# Netdata Security
NETDATA_FIREWALL_BLOCK_DIRECT="true"
NETDATA_REGISTRY_ENABLED="false"
NETDATA_ANONYMOUS_STATISTICS="false"

# ==============================================================================
# DYNAMIC OPTIMIZATION CONFIGURATION (MILESTONE 6)
# ==============================================================================

# Hardware optimization ratios
N8N_EXECUTION_PROCESS_RATIO="0.75"
N8N_MEMORY_RATIO="0.4"
N8N_TIMEOUT_BASE="180"

# Docker optimization ratios  
DOCKER_MEMORY_RATIO="0.75"
DOCKER_CPU_RATIO="0.8"

# Nginx optimization ratios
NGINX_WORKER_PROCESS_RATIO="1.0"
NGINX_WORKER_CONNECTIONS_RATIO="1024"

# Redis optimization ratios
REDIS_MEMORY_RATIO="0.1"
REDIS_MAXMEMORY_POLICY="allkeys-lru"

# Netdata optimization ratios
NETDATA_MEMORY_RATIO="0.05"
NETDATA_UPDATE_EVERY="1"

# Hardware change detection
HARDWARE_CHECK_INTERVAL="3600"
OPTIMIZATION_DELAY_SECONDS="30"

# ==============================================================================
# MULTI-USER CONFIGURATION (MILESTONE 7)
# ==============================================================================

# Multi-user settings
MULTI_USER_ENABLED="true"
MAX_USERS="1000"
USER_ISOLATION_ENABLED="true"
USER_DATA_PATH="/opt/n8n/users"

# User quotas (default values)
DEFAULT_USER_STORAGE_QUOTA="1GB"
DEFAULT_USER_WORKFLOW_QUOTA="100"
DEFAULT_USER_EXECUTION_QUOTA="10000"

# User session management
USER_SESSION_TIMEOUT="3600"
MAX_CONCURRENT_SESSIONS="5"
SESSION_CLEANUP_INTERVAL="900"

# User cleanup settings
INACTIVE_USER_CLEANUP_DAYS="90"
TEMP_FILES_CLEANUP_DAYS="7"
EXECUTION_LOG_RETENTION_DAYS="30"

# ==============================================================================
# IFRAME EMBEDDING CONFIGURATION (MILESTONE 7)
# ==============================================================================

# Iframe embedding settings
IFRAME_EMBEDDING_ENABLED="true"
# WEBAPP_DOMAIN is auto-derived from WEBAPP_SERVER_IP
WEBAPP_DOMAIN_ALT="http://localhost:3001"

# CORS configuration
CORS_ENABLED="true"
CORS_ALLOW_CREDENTIALS="true"
CORS_MAX_AGE="86400"

# Content Security Policy
CSP_ENABLED="true"
CSP_FRAME_ANCESTORS="'self'"

# Cross-origin communication
POSTMESSAGE_API_ENABLED="true"
SESSION_SYNC_ENABLED="true"
SESSION_SYNC_INTERVAL="300"

# ==============================================================================
# CROSS-SERVER COMMUNICATION (MILESTONE 7)
# ==============================================================================

# Web app server configuration
WEBAPP_SERVER_IP="192.168.1.100"
WEBAPP_SERVER_PORT="3001"
# WEBAPP_DOMAIN, WEBAPP_WEBHOOK_URL, WEBAPP_UPLOAD_URL, WEBAPP_DOWNLOAD_URL
# are auto-derived from WEBAPP_SERVER_IP and WEBAPP_SERVER_PORT

# API authentication
API_AUTH_ENABLED="true"
JWT_SECRET=""
JWT_EXPIRES_IN="24h"
API_RATE_LIMIT_WINDOW="900000"
API_RATE_LIMIT_MAX_REQUESTS="1000"

# Webhook forwarding
WEBHOOK_FORWARDING_ENABLED="true"
WEBHOOK_RETRY_ENABLED="true"
WEBHOOK_MAX_RETRIES="3"
WEBHOOK_RETRY_DELAY="5000"

# Health checks and monitoring
HEALTH_CHECK_ENABLED="true"
HEALTH_CHECK_INTERVAL="120"
HEALTH_CHECK_TIMEOUT="10"
HEALTH_CHECK_MAX_FAILURES="3"

# File transfer
FILE_TRANSFER_ENABLED="true"
FILE_TRANSFER_METHOD="https"
MAX_FILE_SIZE="100MB"
MAX_DAILY_TRANSFERS="1000"

# ==============================================================================
# USER MONITORING AND ANALYTICS (MILESTONE 7)
# ==============================================================================

# Monitoring settings
USER_MONITORING_ENABLED="true"
EXECUTION_TRACKING_ENABLED="true"
STORAGE_MONITORING_ENABLED="true"
PERFORMANCE_ANALYTICS_ENABLED="true"

# Metrics collection
METRICS_COLLECTION_INTERVAL="300"
METRICS_RETENTION_DAYS="90"
SYSTEM_METRICS_ENABLED="true"

# Reporting
DAILY_REPORTS_ENABLED="true"
WEEKLY_REPORTS_ENABLED="true"
MONTHLY_REPORTS_ENABLED="true"
REPORT_GENERATION_TIME="01:00"

# Alerting
STORAGE_ALERT_THRESHOLD="80"
PERFORMANCE_ALERT_THRESHOLD="90"
ERROR_RATE_ALERT_THRESHOLD="10"

# Analytics
USAGE_TRENDS_ENABLED="true"
BILLING_ANALYTICS_ENABLED="true"
PREDICTIVE_ANALYTICS_ENABLED="false"

# ==============================================================================
# USER MANAGEMENT API (MILESTONE 7)
# ==============================================================================

# API server settings
USER_API_ENABLED="true"
USER_API_PORT="3001"
USER_API_HOST="localhost"

# API security
API_KEY_AUTH_ENABLED="true"
API_JWT_AUTH_ENABLED="true"
API_OAUTH2_ENABLED="false"

# API rate limiting
API_USER_RATE_LIMIT="30"
API_ADMIN_RATE_LIMIT="100"
API_GLOBAL_RATE_LIMIT="1000"

# ==============================================================================
# BACKUP CONFIGURATION (MILESTONE 8)
# ==============================================================================

# Backup location and directories
BACKUP_LOCATION="/opt/n8n/backups"
BACKUP_ENABLED="true"

# Backup schedule (systemd timer format - these are defaults, actual timers are in systemd)
BACKUP_SCHEDULE="0 2 * * *"
BACKUP_CLEANUP_SCHEDULE="0 3 * * *"

# Retention policies (number of backups to keep)
BACKUP_RETENTION_DAILY="7"
BACKUP_RETENTION_WEEKLY="4"
BACKUP_RETENTION_MONTHLY="3"
BACKUP_MIN_KEEP="3"

# Storage management
BACKUP_STORAGE_THRESHOLD="85"

# Encryption settings
BACKUP_ENCRYPTION_ENABLED="false"
BACKUP_ENCRYPTION_KEY=""

# Remote backup settings
BACKUP_REMOTE_ENABLED="false"
BACKUP_REMOTE_TYPE=""
BACKUP_S3_BUCKET=""
BACKUP_S3_REGION=""
BACKUP_SFTP_HOST=""
BACKUP_SFTP_USER=""
BACKUP_SFTP_PATH=""

# Email notifications
BACKUP_EMAIL_NOTIFY="true"

# ==============================================================================
# SECURITY CONFIGURATION (MILESTONE 9)
# ==============================================================================

# Master security toggle
SECURITY_ENABLED="true"

# fail2ban configuration
FAIL2BAN_ENABLED="true"
FAIL2BAN_BANTIME="3600"
FAIL2BAN_MAXRETRY="5"
FAIL2BAN_FINDTIME="600"
FAIL2BAN_EMAIL_NOTIFY="true"

# IP whitelist (comma-separated IPs to never ban)
# Example: "192.168.1.100,10.0.0.1"
SECURITY_WHITELIST_IPS=""

# Rate limiting (nginx)
RATE_LIMIT_WEBHOOK="10r/s"
RATE_LIMIT_API="30r/s"
RATE_LIMIT_UI="100r/s"

# Geographic IP blocking (optional)
GEO_BLOCKING_ENABLED="false"
GEO_BLOCK_COUNTRIES=""
GEO_ALLOW_COUNTRIES=""
GEO_MODE="blocklist"
GEO_ALLOW_WEBHOOKS="false"

# Security monitoring and alerting
SECURITY_ALERT_THRESHOLD="10"
SECURITY_REPORT_SCHEDULE="0 6 * * *"
